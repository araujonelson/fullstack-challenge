name: Dispatch CD
on:
  push:
    branches: [devel, stage, prod]

jobs:
  dispatch:
    runs-on: ubuntu-latest

    steps:
      - name: Trigger infra-repo deployment
        uses: peter-evans/repository-dispatch@v3
        with:
          token:       ${{ secrets.GITHUB_TOKEN }}
          repository:  my-org/infra-repo
          event-type:  deploy
          client-payload: |
            {
              "environment": "${{ github.ref_name }}",
              "app_sha":     "${{ github.sha }}"
            }